<div class="max-w-4xl mx-auto p-6 space-y-8">

  <!-- Oversize warning modal -->
  <div *ngIf="showOversizeModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded shadow-lg w-full max-w-sm p-6 space-y-4 text-center">
      <p class="text-lg">Images or videos over 5‚ÄØMB are not allowed. Please compress before uploading.</p>
      <button class="bg-[#4EABBA] text-white px-4 py-2 rounded" (click)="showOversizeModal=false">
        OK
      </button>
    </div>
  </div>

  <!-- CTA Form -->
  <section class="bg-white p-4 rounded shadow space-y-4">
    <h2 class="text-xl font-semibold">Page CTA</h2>
    <form
      [formGroup]="ctaForm"
      (ngSubmit)="saveCta()"
      class="grid grid-cols-1 md:grid-cols-2 gap-4"
    >
      <input formControlName="title" placeholder="CTA Title" class="border p-2 rounded"/>
      <input formControlName="buttonText" placeholder="Button Text" class="border p-2 rounded"/>
      <textarea formControlName="description" placeholder="CTA Description" rows="2"
        class="border p-2 rounded md:col-span-2"></textarea>
      <input formControlName="buttonRoute" placeholder="Button Route" class="border p-2 rounded md:col-span-2"/>
      <button type="submit"
        class="bg-[#4EABBA] text-white px-4 py-2 rounded col-span-1 md:col-span-2 disabled:opacity-50"
        [disabled]="ctaForm.invalid || ctaSubmitting"
      >
        {{ ctaSubmitting ? 'Saving‚Ä¶' : 'Save CTA' }}
      </button>
    </form>
  </section>

  <!-- Sections header -->
  <div class="flex justify-between items-center">
    <h2 class="text-2xl font-semibold">Sections for ‚Äú{{ caseStudyTitle }}‚Äù case study.</h2>
    <button (click)="openModal('create')" class="bg-[#4EABBA] text-white px-4 py-2 rounded">
      New Section
    </button>
  </div>

  <!-- Draggable list -->
  <div cdkDropList (cdkDropListDropped)="drop($event)" class="space-y-4">
    <div *ngFor="let sec of sections" cdkDrag
      class="bg-white p-4 rounded shadow flex justify-between items-center"
    >
      <div>
        <span class="font-semibold">{{ sec.type }}</span>
        <span class="ml-2 text-sm text-gray-500">Order: {{ sec.order }}</span>
        <div class="text-sm mt-1">
          {{ sec.type === 'banner' ? $any(sec.data).headline : $any(sec.data).title }}
          <span *ngIf="!sec.isActive"
            class="ml-2 px-1 text-xs bg-red-200 text-red-800 rounded">
            Inactive
          </span>
        </div>
      </div>
      <div class="flex gap-2">
        <button (click)="openModal('edit', sec)" title="Edit">‚úèÔ∏è</button>
        <button (click)="confirmDelete(sec)" title="Delete">üóëÔ∏è</button>
      </div>
    </div>
  </div>

  <!-- Create/Edit Modal -->
  <div *ngIf="showModal"
    class="fixed inset-0 bg-black bg-opacity-50 flex items-start justify-center pt-2 z-50"
  >
    <div class="modal-container bg-white rounded shadow-lg w-full max-w-2xl overflow-auto max-h-[80vh]">
      <header class="modal-header flex justify-between items-center p-4 border-b">
        <h3 class="text-xl font-semibold">{{ modalMode==='create' ? 'New Section' : 'Edit Section' }}</h3>
        <button (click)="closeModal()">‚úñÔ∏è</button>
      </header>

      <div class="modal-body p-4">
        <form [formGroup]="modalForm">

          <!-- Type / Order / Active -->
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
            <label class="flex flex-col">
              <span class="font-semibold mb-1">Type</span>
              <select formControlName="type" class="border p-2 rounded">
                <option value="banner">banner</option>
                <option value="content">content</option>
              </select>
            </label>
            <label class="flex flex-col">
              <span class="font-semibold mb-1">Order</span>
              <input type="number" formControlName="order" class="border p-2 rounded"/>
            </label>
            <label class="flex items-center space-x-2">
              <input type="checkbox" formControlName="isActive"/><span class="font-semibold">Active</span>
            </label>
          </div>

          <!-- Banner fields -->
          <div *ngIf="modalForm.value.type==='banner'" class="space-y-4 mb-4">
            <input formControlName="eyebrow" placeholder="Eyebrow" class="border p-2 rounded w-full"/>
            <input formControlName="headline" placeholder="Headline" class="border p-2 rounded w-full"/>
            <input formControlName="subtitle" placeholder="Subtitle (optional)" class="border p-2 rounded w-full"/>
          </div>

          <!-- Content fields -->
          <div *ngIf="modalForm.value.type==='content'" class="space-y-4 mb-4">
            <input formControlName="title" placeholder="Title" class="border p-2 rounded w-full"/>

            <div *ngIf="modalForm.value.divider" class="grid grid-cols-2 gap-4">
              <textarea formControlName="description" rows="3"
                placeholder="Column¬†1 Description" class="border p-2 rounded w-full"></textarea>
              <textarea formControlName="column2Description" rows="3"
                placeholder="Column¬†2 Description" class="border p-2 rounded w-full"></textarea>
            </div>
            <div *ngIf="!modalForm.value.divider">
              <textarea formControlName="description" rows="3"
                placeholder="Description" class="border p-2 rounded w-full"></textarea>
            </div>

            <div class="grid grid-cols-2 gap-4 items-center">
              <label class="flex items-center space-x-2">
                <input type="checkbox" formControlName="divider"/><span>Show Divider</span>
              </label>
              <label class="flex items-center space-x-2">
                <span class="font-semibold">Image Position</span>
                <select formControlName="imagePosition" class="border p-2 rounded">
                  <option value="none">none</option>
                  <option value="left">left</option>
                  <option value="right">right</option>
                </select>
              </label>
            </div>

            <input formControlName="intro" placeholder="Intro (golden)"
              class="border p-2 rounded w-full"/>
            <input formControlName="outro" placeholder="Outro (golden)"
              class="border p-2 rounded w-full"/>
          </div>

          <!-- File upload & preview -->
          <div class="space-y-2 mb-4">
            <label class="block font-semibold">Upload Image/Video</label>
            <input type="file"
                   (change)="onMediaSelected($event)"
                   accept="image/*,video/*"
                   class="block mb-2"/>
            <div *ngIf="mediaPreviewUrl" class="relative">
              <!-- use mediaPreviewUrl here -->
              <img *ngIf="mediaPreviewUrl.startsWith('data:image')"
                   [src]="mediaPreviewUrl"
                   class="max-h-40 rounded shadow"/>
              <video *ngIf="mediaPreviewUrl.startsWith('data:video')"
                     [src]="mediaPreviewUrl"
                     controls
                     class="max-h-40 rounded shadow"></video>
              <button type="button"
                      class="absolute top-1 right-1 bg-red-600 text-white rounded-full w-6 h-6 flex items-center justify-center"
                      (click)="removeMedia()">
                ‚úñÔ∏è
              </button>
            </div>
          </div>

        </form>
      </div>

      <footer class="modal-footer flex justify-end gap-2 p-4 border-t">
        <button class="bg-red-200 text-white px-4 py-2 rounded" (click)="closeModal()">Cancel</button>
        <button class="bg-[#4EABBA] text-white px-4 py-2 rounded"
          [disabled]="modalForm.invalid || submitting"
          (click)="saveSection()">
          {{ submitting ? 'Saving‚Ä¶' : (modalMode==='create'?'Create':'Save') }}
        </button>
      </footer>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div *ngIf="showDeleteModal"
    class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
  >
    <div class="bg-white rounded shadow-lg w-full max-w-md p-6 space-y-4">
      <h2 class="text-xl font-semibold">Confirm Deletion</h2>
      <p>Are you sure you want to delete this section?</p>
      <div class="flex justify-end gap-2 mt-4">
        <button (click)="cancelDelete()" class="px-4 py-2 border rounded" [disabled]="deleting">
          Cancel
        </button>
        <button (click)="deleteSection()"
          class="bg-red-200 text-white px-4 py-2 rounded disabled:opacity-50"
          [disabled]="deleting"
        >
          {{ deleting ? 'Deleting‚Ä¶' : 'Delete' }}
        </button>
      </div>
    </div>
  </div>

  <!-- Result Modal -->
  <div *ngIf="showResult"
    class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
  >
    <div class="bg-white rounded shadow-lg w-full max-w-sm p-6 space-y-4 text-center">
      <p class="text-lg">{{ resultMsg }}</p>
      <button class="bg-[#4EABBA] text-white px-4 py-2 rounded" (click)="closeResult()">
        OK
      </button>
    </div>
  </div>

</div>
